<h2>Create Experiment: {{ experimentType?.name }}</h2>
<form [formGroup]="form" (ngSubmit)="submit()">

  <mat-form-field appearance="fill">
    <mat-label>Title</mat-label>
    <input matInput formControlName="title" placeholder="Experiment title">
  </mat-form-field>

  <div formGroupName="data" *ngIf="experimentType?.fields?.length">
    <div *ngFor="let f of experimentType.fields">
      <ng-container [ngSwitch]="f.type">
        <!-- Text -->
        <mat-form-field appearance="fill" *ngSwitchCase="'text'">
          <mat-label>{{f.name}}</mat-label>
          <input matInput [formControlName]="normalizeKey(f.name)">
        </mat-form-field>

        <!-- Textarea -->
        <mat-form-field appearance="fill" *ngSwitchCase="'textarea'">
          <mat-label>{{f.name}}</mat-label>
          <textarea matInput [formControlName]="normalizeKey(f.name)"></textarea>
        </mat-form-field>

        <!-- Number -->
        <mat-form-field appearance="fill" *ngSwitchCase="'number'">
          <mat-label>{{f.name}}</mat-label>
          <input matInput type="number" [formControlName]="normalizeKey(f.name)">
        </mat-form-field>

        <!-- Date -->
        <mat-form-field appearance="fill" *ngSwitchCase="'date'">
          <mat-label>{{f.name}}</mat-label>
          <input matInput type="date" [formControlName]="normalizeKey(f.name)">
        </mat-form-field>

        <!-- Boolean -->
        <mat-checkbox *ngSwitchCase="'boolean'" [formControlName]="normalizeKey(f.name)">
          {{f.name}}
        </mat-checkbox>

        <!-- Select -->
        <mat-form-field appearance="fill" *ngSwitchCase="'select'">
          <mat-label>{{f.name}}</mat-label>
          <mat-select [formControlName]="normalizeKey(f.name)">
            <mat-option *ngFor="let o of f.options" [value]="o">{{o}}</mat-option>
          </mat-select>
        </mat-form-field>

        <!-- List -->
        <div *ngSwitchCase="'list'">
          <label>{{f.name}} (multiple)</label>
          <div formArrayName="{{normalizeKey(f.name)}}">
            <div *ngFor="let c of getListControls(normalizeKey(f.name)).controls; let i=index">
              <input [formControlName]="i">
              <button mat-button color="warn" type="button" (click)="removeListItem(normalizeKey(f.name), i)">Remove</button>
            </div>
            <button mat-button type="button" (click)="addListItem(normalizeKey(f.name))">Add Item</button>
          </div>
        </div>

      </ng-container>
    </div>
  </div>

  <mat-form-field appearance="fill">
    <mat-label>Notes</mat-label>
    <textarea matInput formControlName="notes"></textarea>
  </mat-form-field>

  <button mat-raised-button color="primary" type="submit">Save Experiment</button>
</form>
