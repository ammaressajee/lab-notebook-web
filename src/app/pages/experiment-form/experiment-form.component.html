<mat-card>
  <form [formGroup]="form" (ngSubmit)="submit()" class="experiment-form">

    <!-- Notes Field -->
    <mat-form-field appearance="fill" class="full-width">
      <mat-label>Notes</mat-label>
      <textarea matInput formControlName="notes" rows="3"></textarea>
    </mat-form-field>

    <!-- Dynamic Fields -->
    <div formGroupName="data" class="dynamic-fields">
      <ng-container *ngFor="let key of dataKeys">

        <ng-container [ngSwitch]="getFieldType(key)">

          <!-- Textarea -->
          <mat-form-field *ngSwitchCase="'textarea'" appearance="fill" class="full-width">
            <mat-label>{{ fieldKeyMap[key] }}</mat-label>
            <textarea matInput [formControlName]="key" rows="3"></textarea>
          </mat-form-field>

          <!-- Text Input -->
          <mat-form-field *ngSwitchCase="'text'" appearance="fill" class="full-width">
            <mat-label>{{ fieldKeyMap[key] }}</mat-label>
            <input matInput [formControlName]="key" />
          </mat-form-field>

          <!-- Number Input -->
          <mat-form-field *ngSwitchCase="'number'" appearance="fill" class="full-width">
            <mat-label>{{ fieldKeyMap[key] }}</mat-label>
            <input matInput type="number" [formControlName]="key" />
          </mat-form-field>

          <!-- Date Picker -->
          <mat-form-field *ngSwitchCase="'date'" appearance="fill" class="full-width">
            <mat-label>{{ fieldKeyMap[key] }}</mat-label>
            <input matInput [formControlName]="key" />
            <mat-datepicker-toggle matSuffix ></mat-datepicker-toggle>
            <mat-datepicker #picker_{{key}}></mat-datepicker>
          </mat-form-field>

          <!-- Boolean / Checkbox -->
          <mat-checkbox *ngSwitchCase="'boolean'" [formControlName]="key" class="mb-2">
            {{ fieldKeyMap[key] }}
          </mat-checkbox>

          <!-- Select -->
          <mat-form-field *ngSwitchCase="'select'" appearance="fill" class="full-width">
            <mat-label>{{ fieldKeyMap[key] }}</mat-label>
            <mat-select [formControlName]="key">
              <mat-option *ngFor="let option of getFieldOptions(key)" [value]="option">{{ option }}</mat-option>
            </mat-select>
          </mat-form-field>

          <!-- List / Array -->
          <div *ngSwitchCase="'list'" class="list-field">
            <label>{{ fieldKeyMap[key] }}</label>
            <div formArrayName="{{key}}">
              <div *ngFor="let ctrl of getListControls(key).controls; let i = index" class="list-item"
                [formGroupName]="i">
                <mat-form-field appearance="fill" class="list-input">
                  <input matInput [formControlName]="i" placeholder="Item {{ i + 1 }}" />
                </mat-form-field>
                <button mat-icon-button type="button" color="warn" (click)="removeListItem(key, i)">
                  <mat-icon>delete</mat-icon>
                </button>
              </div>
            </div>
            <button mat-stroked-button color="primary" type="button" (click)="addListItem(key)">Add Item</button>
          </div>

        </ng-container>
      </ng-container>
    </div>

    <!-- Submit Button -->
    <div class="form-actions mt-4">
      <button mat-raised-button color="primary" type="submit">Save Experiment</button>
    </div>

  </form>
</mat-card>
