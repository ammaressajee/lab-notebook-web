<mat-card class="experiment-card">
  <!-- Header -->
  <div class="experiment-header">
    <h2 class="experiment-title">{{ experimentTypeName || 'New Experiment' }}</h2>
    <div class="project-info">
      <span class="project-name">Project: {{ projectName }}</span>
      <span class="project-date">Date: {{ currentDate | date:'mediumDate' }}</span>
    </div>
  </div>

  <!-- Form -->
  <form [formGroup]="form" (ngSubmit)="submit()" class="experiment-form">

    <!-- Dynamic Fields -->
    <div formGroupName="data" class="dynamic-fields">
      <ng-container *ngFor="let key of dataKeys">
        <ng-container [ngSwitch]="getFieldType(key)">

          <!-- Textarea -->
          <mat-form-field *ngSwitchCase="'textarea'" appearance="fill" class="full-width">
            <mat-label>{{ fieldKeyMap[key] }}</mat-label>
            <textarea matInput [formControlName]="key" rows="3"></textarea>
          </mat-form-field>

          <!-- Text Input -->
          <mat-form-field *ngSwitchCase="'text'" appearance="fill" class="full-width">
            <mat-label>{{ fieldKeyMap[key] }}</mat-label>
            <input matInput [formControlName]="key" />
          </mat-form-field>

          <!-- Number Input -->
          <mat-form-field *ngSwitchCase="'number'" appearance="fill" class="full-width">
            <mat-label>{{ fieldKeyMap[key] }}</mat-label>
            <input matInput type="number" [formControlName]="key" />
          </mat-form-field>

          <!-- Date -->
          <mat-form-field *ngSwitchCase="'date'" appearance="fill" class="full-width">
            <mat-label>{{ fieldKeyMap[key] }}</mat-label>
            <input matInput [matDatepicker]="pickers[key]" [formControlName]="key" />
            <mat-datepicker-toggle matSuffix [for]="pickers[key]"></mat-datepicker-toggle>
            <mat-datepicker touchUi #datepicker></mat-datepicker>
          </mat-form-field>

          <!-- Checkbox -->
          <mat-checkbox *ngSwitchCase="'boolean'" [formControlName]="key">
            {{ fieldKeyMap[key] }}
          </mat-checkbox>

          <!-- Select -->
          <mat-form-field *ngSwitchCase="'select'" appearance="fill" class="full-width">
            <mat-label>{{ fieldKeyMap[key] }}</mat-label>
            <mat-select [formControlName]="key">
              <mat-option *ngFor="let option of getFieldOptions(key)" [value]="option">
                {{ option }}
              </mat-option>
            </mat-select>
          </mat-form-field>

          <!-- List -->
          <div *ngSwitchCase="'list'" class="list-field">
            <label>{{ fieldKeyMap[key] }}</label>
            <div formArrayName="{{key}}">
              <div *ngFor="let ctrl of getListControls(key).controls; let i=index" [formGroupName]="i"
                class="list-item">
                <mat-form-field appearance="fill" class="list-input">
                  <input matInput [formControlName]="i" placeholder="Item {{i+1}}" />
                </mat-form-field>
                <button mat-icon-button color="warn" type="button" (click)="removeListItem(key, i)">
                  <mat-icon>delete</mat-icon>
                </button>
              </div>
            </div>
            <button mat-stroked-button color="primary" type="button" (click)="addListItem(key)">Add Item</button>
          </div>

        </ng-container>
      </ng-container>
    </div>

    <mat-card class="global-section">
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Start Date</mat-label>
        <input matInput [matDatepicker]="pickerStart" formControlName="start_date">
        <mat-datepicker-toggle matSuffix [for]="pickerStart"></mat-datepicker-toggle>
        <mat-datepicker #pickerStart></mat-datepicker>
      </mat-form-field>

      <mat-form-field appearance="outline" class="full-width">
        <mat-label>End Date</mat-label>
        <input matInput [matDatepicker]="pickerEnd" formControlName="end_date">
        <mat-datepicker-toggle matSuffix [for]="pickerEnd"></mat-datepicker-toggle>
        <mat-datepicker #pickerEnd></mat-datepicker>
      </mat-form-field>

      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Moving Forward</mat-label>
        <textarea matInput formControlName="moving_forward"></textarea>
      </mat-form-field>

      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Conclusions</mat-label>
        <textarea matInput formControlName="conclusions"></textarea>
      </mat-form-field>
    </mat-card>

    <!-- Notes -->
    <mat-form-field appearance="fill" class="full-width">
      <mat-label>Notes</mat-label>
      <textarea matInput formControlName="notes" rows="3"></textarea>
    </mat-form-field>

    <!-- Submit Button -->
    <div class="form-actions">
      <button mat-raised-button color="primary" type="submit">Save Experiment</button>
    </div>
  </form>
</mat-card>