<h2>Project: {{ projectId }}</h2>

<h3>Create New Experiment</h3>
<mat-form-field appearance="fill">
  <mat-label>Select Blueprint</mat-label>
  <mat-select [(ngModel)]="selectedBlueprintId" name="blueprintSelect">
    <mat-option *ngFor="let type of experimentTypes" [value]="type.id">
      {{ type.name }}
    </mat-option>
  </mat-select>
</mat-form-field><br>

<button mat-raised-button color="primary" (click)="createExperiment()">+ Create Experiment</button><br><br>

<mat-divider></mat-divider><br><br>
<h2>Experiments</h2>

<div *ngFor="let exp of experiments" class="experiment-card">
  <!-- Header: clickable to expand/collapse -->
  <div class="experiment-header" (click)="exp.expanded = !exp.expanded">
    <span class="title">{{ exp.title }}</span>
    <span class="type">({{ exp.experiment_type_name }})</span>
    <span class="toggle-icon">{{ exp.expanded ? '▲' : '▼' }}</span>
  </div>

  <!-- Expanded content -->
  <div class="experiment-details" *ngIf="exp.expanded">
    <table class="details-table">
      <tbody>
        <tr *ngFor="let key of getDataKeys(exp.data)">
          <td class="field-name">{{ key }}</td>
          <td class="field-value">{{ exp.data[key] }}</td>
        </tr>
      </tbody>
    </table>

    <p><strong>Notes:</strong> {{ exp.notes || 'No notes' }}</p>

    <p><strong>Start Date:</strong>
      {{ exp.start_date ? (exp.start_date | date:'mediumDate') : 'Not set' }}
    </p>

    <p><strong>End Date:</strong>
      {{ exp.end_date ? (exp.end_date | date:'mediumDate') : 'Not set' }}
    </p>

    <p><strong>Moving Forward:</strong>
      {{ exp.moving_forward || 'Not specified' }}
    </p>

    <p><strong>Conclusions:</strong>
      {{ exp.conclusions || 'Not specified' }}
    </p>
  </div>

</div>